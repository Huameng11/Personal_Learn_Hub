# æ ‘è“æ´¾4Bå­¦ä¹ è®°å½•

## ä¸€ã€åŸºç¡€é…ç½®

> ç‹æ‘è·¯ç”±å™¨ä¸‹IPåœ°å€ï¼š192.168.124.8
>
> æ¥¼ä¸Šè·¯ç”±å™¨ä¸‹IPï¼š192.168.31.203
>
> ç”¨æˆ·åï¼špi
> å¯†ç ï¼šraspberry
> æ–°å¯†ç ï¼šhua..

------

### æ ¸å¿ƒç³»ç»Ÿä¸ç¡¬ä»¶ä¿¡æ¯

### #ä¸€é”®å¼è„šæœ¬

ä¸ºäº†é¿å…æ‰‹åŠ¨è¾“å…¥è¿™ä¹ˆå¤šå‘½ä»¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„è„šæœ¬æ–‡ä»¶æ¥ä¸€æ¬¡æ€§è¿è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­æ–¹ä¾¿æŸ¥çœ‹ã€‚

åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼š

```bash
nano system_report.sh
```

å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼š

```bash
#!/bin/bash

REPORT_FILE="/home/pi/pi_system_report_$(date +%Y%m%d_%H%M%S).txt"

{
    echo "===================== æ ‘è“æ´¾ç³»ç»Ÿå…¨é¢é…ç½®æŠ¥å‘Š ====================="
    echo "ç”Ÿæˆæ—¶é—´: $(date)"
    echo "=================================================================="
    echo ""
    echo "---------------------- 1. æ ¸å¿ƒç³»ç»Ÿä¸ç¡¬ä»¶ä¿¡æ¯ ----------------------"
    echo ">> OS ç‰ˆæœ¬:"
    cat /etc/os-release
    echo ""
    echo ">> å†…æ ¸ç‰ˆæœ¬:"
    uname -a
    echo ""
    echo ">> ä¸»æœºå:"
    hostname
    echo ""
    echo ">> è¿è¡Œæ—¶é—´:"
    uptime
    echo ""
    echo ">> CPU ä¿¡æ¯:"
    lscpu
    echo ""
    echo ">> ARM é¢‘ç‡å’Œæ¸©åº¦:"
    vcgencmd measure_clock arm
    vcgencmd measure_temp
    echo ""
    echo ">> å†…å­˜ä¿¡æ¯:"
    free -h
    echo ""
    echo ">> ç£ç›˜ä½¿ç”¨:"
    df -h
    echo ""
    echo ">> GPU å†…å­˜:"
    vcgencmd get_mem gpu
    echo ""

    echo "---------------------- 2. ç½‘ç»œé…ç½® ----------------------"
    echo ">> IP åœ°å€:"
    hostname -I
    echo ""
    echo ">> ç½‘ç»œæ¥å£:"
    ip addr show
    echo ""
    echo ">> DNS é…ç½®:"
    cat /etc/resolv.conf
    echo ""
    echo ">> è·¯ç”±è¡¨:"
    ip route
    echo ""

    echo "---------------------- 3. ç³»ç»Ÿè®¾ç½® ----------------------"
    echo ">> ç¯å¢ƒå˜é‡:"
    printenv
    echo ""
    echo ">> æ—¶åŒº:"
    timedatectl status
    echo ""
    echo ">> åŒºåŸŸè®¾ç½®:"
    locale
    echo ""

    echo "---------------------- 4. ç¡¬ä»¶ä¸æ ‘è“æ´¾ç‰¹å®šè®¾ç½® ----------------------"
    echo ">> USB è®¾å¤‡:"
    lsusb
    echo ""
    echo ">> Config.txt ç”Ÿæ•ˆçš„é…ç½® (æ•°å­—):"
    vcgencmd get_config int
    echo ""
    echo ">> Config.txt ç”Ÿæ•ˆçš„é…ç½® (å­—ç¬¦ä¸²):"
    vcgencmd get_config str
    echo ""
    echo ">> æ‘„åƒå¤´çŠ¶æ€:"
    vcgencmd get_camera
    echo ""
    echo ">> æ˜¾ç¤ºä¿¡æ¯:"
    tvservice -s
    echo ""

} > "$REPORT_FILE"

echo "ç³»ç»ŸæŠ¥å‘Šå·²ç”Ÿæˆè‡³: $REPORT_FILE"
```

ä¿å­˜å¹¶é€€å‡ºï¼ˆæŒ‰ `Ctrl+X`, ç„¶å `Y`, ç„¶å `Enter`ï¼‰ã€‚

ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œå®ƒï¼š

```bash
chmod +x system_report.sh
./system_report.sh
```

è„šæœ¬ä¼šåœ¨æ‚¨çš„å®¶ç›®å½•ï¼ˆ`/home/pi/`ï¼‰ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º `pi_system_report_æ—¥æœŸæ—¶é—´.txt` çš„æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†æ‚¨å½“å‰æ ‘è“æ´¾å‡ ä¹æ‰€æœ‰çš„é‡è¦è®¾ç½®ã€‚æ‚¨å¯ä»¥ç”¨ `cat` æˆ– `less` å‘½ä»¤æŸ¥çœ‹å®ƒï¼Œæˆ–è€…ç”¨ `scp` å‘½ä»¤å°†å…¶ä¼ è¾“åˆ°æ‚¨çš„ç”µè„‘ä¸Šä»”ç»†é˜…è¯»ã€‚

```
less /home/pi/pi_system_report_20241010_123456.txt
```

- **ç¡¬ä»¶é…ç½®**

  >  pi@raspberrypi 
  > OS: Raspbian GNU/Linux 12 (bookworm) aarch64 
  > Host: Raspberry Pi 4 Model B Rev 1.5 
  > Kernel: 6.1.0-rpi7-rpi-v8 
  > Uptime: 36 mins 
  > Packages: 1558 (dpkg) 
  > Shell: bash 5.2.15 
  > Terminal: /dev/pts/0 
  > CPU: (4) @ 1.800GHz 
  > Memory: 216MiB / 7811MiB 

### è£…ç³»ç»Ÿ

- ä¸‹æ–¹åœ°å€ï¼Œä¸‹è½½å®˜æ–¹å·¥å…·**Raspberry Pi Imager**
- https://www.raspberrypi.com/software/

- å®‰è£…å¸¦æ¡Œé¢64ä½é•œåƒ
- æ‰‹åŠ¨ä¸‹è½½é•œåƒåœ°å€
- https://www.raspberrypi.com/software/operating-systems/

## äºŒã€åŸºç¡€å‘½ä»¤

### 1.æ”¹å¯†ç 

```bash
passwd
```

### 2.æ›´æ–°è½¯ä»¶åˆ—è¡¨

```bash
# æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…

sudo apt update
sudo apt upgrade -y

# å®‰è£…å¿…è¦ä¾èµ–

sudo apt install -y wget curl
```

```bash
#æŸ¥çœ‹ç«¯å£ä¿¡æ¯
sudo ss -tulnp
â€‹â€‹è¾“å‡ºç¤ºä¾‹â€‹â€‹ï¼š
Netid State  Recv-Q Send-Q Local Address:Port Peer Address:Port Process
tcp   LISTEN 0      80     0.0.0.0:80        0.0.0.0:*        users:(("nginx",pid=1234,fd=6))
tcp   LISTEN 0      128    127.0.0.1:3306    0.0.0.0:*        users:(("mysqld",pid=5678,fd=14))
â€‹â€‹å‚æ•°è¯´æ˜â€‹â€‹ï¼š
-tï¼šTCP ç«¯å£
-uï¼šUDP ç«¯å£
-lï¼šä»…æ˜¾ç¤ºç›‘å¬ç«¯å£
-nï¼šä¸è§£ææœåŠ¡å
-pï¼šæ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯

```



### ğŸ–¥ï¸ ç³»ç»Ÿä¿¡æ¯ä¸çŠ¶æ€ç®¡ç†

| å‘½ä»¤                    | è¯´æ˜                           | ç¤ºä¾‹/å¤‡æ³¨                                             |
| :---------------------- | :----------------------------- | :---------------------------------------------------- |
| `hostname -I`           | **æŸ¥çœ‹æ ‘è“æ´¾çš„IPåœ°å€**         | è¿™æ˜¯é€šè¿‡SSHè¿æ¥çš„å…³é”®ä¿¡æ¯                             |
| `uname -a`              | æ˜¾ç¤ºç³»ç»Ÿè¯¦ç»†å†…æ ¸ä¿¡æ¯           |                                                       |
| `cat /etc/os-release`   | **æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬**           | ç¡®è®¤ä½ è¿è¡Œçš„Raspberry Pi OSç‰ˆæœ¬                       |
| `vcgencmd measure_temp` | **æŸ¥çœ‹æ ‘è“æ´¾SoCï¼ˆCPUï¼‰æ¸©åº¦**   | éå¸¸å®ç”¨çš„ç¡¬ä»¶ç›‘æ§å‘½ä»¤                                |
| `uptime`                | æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œäº†å¤šä¹…             |                                                       |
| `top` æˆ– `htop`         | **åŠ¨æ€å®æ—¶æŸ¥çœ‹è¿›ç¨‹å’Œèµ„æºå ç”¨** | `htop` æ›´ç›´è§‚ï¼Œå¯èƒ½éœ€è¦å®‰è£… (`sudo apt install htop`) |
| `df -h`                 | **æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ**       | `-h` é€‰é¡¹è¡¨ç¤ºä»¥äººç±»æ˜“è¯»ï¼ˆGB, MBï¼‰æ ¼å¼æ˜¾ç¤º             |
| `free -h`               | **æŸ¥çœ‹å†…å­˜ï¼ˆRAMï¼‰ä½¿ç”¨æƒ…å†µ**    |                                                       |
| `exit` æˆ– `logout`      | **é€€å‡ºå½“å‰ç»ˆç«¯æˆ–SSHä¼šè¯**      |                                                       |

### ğŸ“ æ–‡ä»¶ä¸ç›®å½•æ“ä½œï¼ˆæœ€å¸¸ç”¨ï¼ï¼‰

| å‘½ä»¤                               | è¯´æ˜                                 | ç¤ºä¾‹/å¤‡æ³¨                                                    |
| :--------------------------------- | :----------------------------------- | :----------------------------------------------------------- |
| `pwd`                              | **æ˜¾ç¤ºå½“å‰æ‰€åœ¨çš„ç›®å½•è·¯å¾„**           |                                                              |
| `ls`                               | **åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹**     | `ls -l` æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œ `ls -a` æ˜¾ç¤ºéšè—æ–‡ä»¶                  |
| `cd <ç›®å½•å>`                      | **åˆ‡æ¢ç›®å½•**                         | `cd ~` å›å®¶ç›®å½•ï¼Œ `cd ..` è¿”å›ä¸Šçº§ç›®å½•                       |
| `mkdir <ç›®å½•å>`                   | **åˆ›å»ºæ–°ç›®å½•**                       | `mkdir my_project`                                           |
| df-h                               | **æŸ¥çœ‹æŒ‚è½½ç¡¬ç›˜**                     |                                                              |
| `rmdir <ç›®å½•å>`                   | åˆ é™¤**ç©º**ç›®å½•                       |                                                              |
| `rm <æ–‡ä»¶å>`                      | **åˆ é™¤æ–‡ä»¶**                         | `rm -r <ç›®å½•å>` **é€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ï¼ˆæ…ç”¨ï¼ï¼‰**          |
| `cp <æºæ–‡ä»¶> <ç›®æ ‡ä½ç½®>`           | **å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•**                   | `cp file.txt ~/backups/` `cp -r dir1/ dir2/` (å¤åˆ¶ç›®å½•)      |
| `mv <æº> <ç›®æ ‡>`                   | **ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼ˆé‡å‘½åï¼‰**         | `mv old.txt new.txt` (é‡å‘½å) `mv file.txt ~/documents/` (ç§»åŠ¨) |
| `cat <æ–‡ä»¶å>`                     | **åœ¨ç»ˆç«¯ä¸­æ˜¾ç¤ºæ–‡ä»¶å…¨éƒ¨å†…å®¹**         | é€‚åˆæŸ¥çœ‹çŸ­æ–‡ä»¶                                               |
| `more <æ–‡ä»¶å>` æˆ– `less <æ–‡ä»¶å>` | **åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹**                 | é€‚åˆæŸ¥çœ‹é•¿æ–‡ä»¶ï¼ŒæŒ‰ç©ºæ ¼ç¿»é¡µï¼ŒæŒ‰ `q` é€€å‡º                      |
| `nano <æ–‡ä»¶å>`                    | **ä½¿ç”¨nanoæ–‡æœ¬ç¼–è¾‘å™¨ä¿®æ”¹æˆ–åˆ›å»ºæ–‡ä»¶** | **æ ‘è“æ´¾è‡ªå¸¦ï¼Œå¯¹æ–°æ‰‹æœ€å‹å¥½**ï¼ŒCtrl+Xé€€å‡ºï¼ŒæŒ‰Yä¿å­˜            |
| `sudo reboot`                      | **ç«‹å³é‡å¯æ ‘è“æ´¾**                   |                                                              |
| `sudo shutdown now`                | **ç«‹å³å…³æœº**                         | `sudo shutdown -h now` æ•ˆæœç›¸åŒ                              |

### ğŸ“¦ è½¯ä»¶åŒ…ç®¡ç† (ä½¿ç”¨ `apt`)

| å‘½ä»¤                          | è¯´æ˜                                             | ç¤ºä¾‹/å¤‡æ³¨                                |
| :---------------------------- | :----------------------------------------------- | :--------------------------------------- |
| `sudo apt update`             | **æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨**ï¼ˆè·å–å¯ç”¨è½¯ä»¶çš„æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯ï¼‰ | **åœ¨å®‰è£…ä»»ä½•æ–°è½¯ä»¶å‰ï¼Œæœ€å¥½å…ˆè¿è¡Œæ­¤å‘½ä»¤** |
| `sudo apt upgrade`            | **å‡çº§æ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ…**                       | æ ¹æ®ç½‘ç»œé€Ÿåº¦ï¼Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´           |
| `sudo apt install <è½¯ä»¶åŒ…å>` | **å®‰è£…ä¸€ä¸ªè½¯ä»¶**                                 | `sudo apt install htop`                  |
| `sudo apt remove <è½¯ä»¶åŒ…å>`  | **å¸è½½ä¸€ä¸ªè½¯ä»¶**                                 |                                          |
| `sudo apt autoremove`         | **è‡ªåŠ¨åˆ é™¤ä¸å†éœ€è¦çš„ä¾èµ–åŒ…**                     | æ¸…ç†ç©ºé—´                                 |

### ğŸ‘¤ ç”¨æˆ·ä¸æƒé™ç®¡ç† (ç†è§£ `sudo`)

| å‘½ä»¤                | è¯´æ˜                               | ç¤ºä¾‹/å¤‡æ³¨                                              |
| :------------------ | :--------------------------------- | :----------------------------------------------------- |
| `passwd`            | **ä¿®æ”¹å½“å‰ç”¨æˆ·çš„å¯†ç **             | å°±æ˜¯ä½ åˆšæ‰é—®çš„ç¬¬ä¸€ä¸ªé—®é¢˜                               |
| `sudo <å‘½ä»¤>`       | **ä»¥è¶…çº§ç®¡ç†å‘˜(root)æƒé™æ‰§è¡Œå‘½ä»¤** | å®‰è£…è½¯ä»¶ã€ä¿®æ”¹ç³»ç»Ÿé…ç½®ç­‰æ“ä½œéƒ½éœ€è¦åŠ  `sudo`            |
| `sudo raspi-config` | **å¯åŠ¨æ ‘è“æ´¾å®˜æ–¹é…ç½®å·¥å…·**         | åœ¨è¿™é‡Œå¯ä»¥æ‰©å±•æ–‡ä»¶ç³»ç»Ÿã€æ›´æ”¹å¯†ç ã€å¯ç”¨æ‘„åƒå¤´/SSHç­‰æ¥å£ |
| `chmod +x <æ–‡ä»¶å>` | **ç»™æ–‡ä»¶æ·»åŠ â€œå¯æ‰§è¡Œâ€æƒé™**         | å½“ä½ ä¸‹è½½äº†ä¸€ä¸ªè„šæœ¬åï¼Œéœ€è¦ç”¨å®ƒæ¥ä½¿è„šæœ¬å¯ä»¥è¿è¡Œ         |

### ğŸŒ ç½‘ç»œç›¸å…³å‘½ä»¤

| å‘½ä»¤          | è¯´æ˜                             | ç¤ºä¾‹/å¤‡æ³¨                                           |
| :------------ | :------------------------------- | :-------------------------------------------------- |
| `ping <åœ°å€>` | **æµ‹è¯•ç½‘ç»œè¿æ¥**                 | `ping google.com` æˆ– `ping 8.8.8.8`ï¼ŒæŒ‰ Ctrl+C åœæ­¢ |
| `ifconfig`    | æŸ¥çœ‹ç½‘ç»œæ¥å£é…ç½®ä¿¡æ¯ï¼ˆå¦‚IPåœ°å€ï¼‰ | æ—§å‘½ä»¤ï¼Œå¯ç”¨ `ip addr` æ›¿ä»£                         |
| `iwconfig`    | æŸ¥çœ‹æ— çº¿ç½‘ç»œä¿¡æ¯                 |                                                     |

### ğŸ”§ è¿›ç¨‹ç®¡ç†

| å‘½ä»¤             | è¯´æ˜                       | ç¤ºä¾‹/å¤‡æ³¨                                |
| :--------------- | :------------------------- | :--------------------------------------- |
| `ps aux`         | **æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ‰€æœ‰è¿›ç¨‹** |                                          |
| `kill <PID>`     | **ç»“æŸä¸€ä¸ªè¿›ç¨‹**           | `<PID>` æ˜¯è¿›ç¨‹å·ï¼Œå¯ä»¥ç”¨ `ps aux` æŸ¥çœ‹åˆ° |
| `pkill <è¿›ç¨‹å>` | æ ¹æ®è¿›ç¨‹åç»“æŸè¿›ç¨‹         | `pkill chromium`                         |

## 2.ç½‘ç»œä»£ç†è®¾ç½®ç›¸å…³

åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š**æœåŠ¡ç«¯éƒ¨ç½² (x-ui)** å’Œ **webç«¯é…ç½® èŠ‚ç‚¹é“¾æ¥**

1. **x-ui æœåŠ¡ç«¯é¢æ¿**ï¼šå°†æ ‘è“æ´¾ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œä¾›å±€åŸŸç½‘å†…å…¶ä»–è®¾å¤‡ä½¿ç”¨ã€‚
2. **webç«¯é…ç½® èŠ‚ç‚¹é“¾æ¥**ï¼šè®©æ ‘è“æ´¾è‡ªèº«èƒ½é€šè¿‡ä»£ç†æ™ºèƒ½åˆ†æµè®¿é—®ç½‘ç»œã€‚

### 2.1 éƒ¨ç½² x-ui æœåŠ¡ç«¯é¢æ¿ (Docker æ–¹æ¡ˆ)

æ­¤æ–¹æ¡ˆä½¿ç”¨ Docker å°† x-ui é¢æ¿å®‰è£…åˆ°å¤–ç½®ç¡¬ç›˜ï¼Œå®ç°æ•°æ®æŒä¹…åŒ–å¹¶ä¿æŠ¤ SD å¡ã€‚

#### å‡†å¤‡å·¥ä½œ

- **GitHub å‚è€ƒåœ°å€**: https://github.com/vaxilu/x-ui
- **å¤–ç½®ç¡¬ç›˜æŒ‚è½½ç‚¹**: ç¡®è®¤å¤–ç½®ç¡¬ç›˜å·²æŒ‚è½½ï¼Œæœ¬æ–‡æ¡£ç¤ºä¾‹è·¯å¾„ä¸º `/media/pi/SNF`ã€‚

#### è§£å†³ Docker æƒé™é—®é¢˜

ä¸ºé¿å…æ¯æ¬¡ä½¿ç”¨ `docker` å‘½ä»¤éƒ½éœ€è¦è¾“å…¥ `sudo`ï¼Œå°†å½“å‰ç”¨æˆ·ï¼ˆpiï¼‰æ·»åŠ åˆ° `docker` ç”¨æˆ·ç»„ã€‚

```
sudo usermod -aG docker pi
```

**æ³¨æ„**ï¼šæ‰§è¡Œåéœ€**æ–­å¼€ SSH é‡æ–°ç™»å½•**æ‰èƒ½ä½¿æƒé™ç”Ÿæ•ˆã€‚

####  è§£å†³ Docker ç½‘ç»œä»£ç†é—®é¢˜

ä¸ºé˜²æ­¢ Docker æœåŠ¡å—ç³»ç»Ÿå…¨å±€ä»£ç†å½±å“è€Œæ— æ³•æ‹‰å–é•œåƒï¼Œéœ€ä¸ºå…¶é…ç½®ç‹¬ç«‹çš„ç½‘ç»œç¯å¢ƒã€‚

1. **åˆ›å»º Docker æœåŠ¡é…ç½®ç›®å½•**:

   ```bash
   sudo mkdir -p /etc/systemd/system/docker.service.d
   ```

2. **åˆ›å»ºå¹¶ç¼–è¾‘ä»£ç†é…ç½®æ–‡ä»¶**:

   ```bash
   sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf
   ```

3. **å†™å…¥ä»¥ä¸‹å†…å®¹**ä»¥æ¸…ç©ºä»£ç†è®¾ç½®ï¼š

   ```bash
   [Service]
   Environment="HTTP_PROXY=http://192.168.31.109:10811/"
   Environment="HTTPS_PROXY=http://192.168.31.109:10811/"
   Environment="NO_PROXY=localhost,127.0.0.1,*.lan"
   ```

4. **é‡è½½é…ç½®å¹¶é‡å¯ Docker æœåŠ¡**:

   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart docker
   ```

#### ä½¿ç”¨ Docker Compose éƒ¨ç½² x-ui

1. **åœ¨å¤–ç½®ç¡¬ç›˜åˆ›å»ºå·¥ä½œç›®å½•**:

   ```bash
   mkdir -p /media/pi/SNF/x-ui-data
   cd /media/pi/SNF/x-ui-data
   ```

2. **åˆ›å»º `docker-compose.yml` æ–‡ä»¶**:

   ```bash
   nano docker-compose.yml
   ```

3. **å†™å…¥ä»¥ä¸‹é…ç½®**:

   ```YAML
   services:
     x-ui:
       image: enwaiax/x-ui:latest
       container_name: x-ui
       restart: unless-stopped
       network_mode: host
       volumes:
         - ./db:/etc/x-ui/
         - ./cert:/root/cert/
       environment:
         - XUI_LOG_LEVEL=warn
         - XUI_LOG_FILE=/etc/x-ui/x-ui.log
   ```

4. **å¯åŠ¨æœåŠ¡**:

   ```bash
   docker-compose up -d
   ```

5. **è®¿é—®é¢æ¿**:

   - **åœ°å€**: `http://192.168.124.8:54321` (è¯·æ ¹æ®å®é™… IP ä¿®æ”¹)
   - **é»˜è®¤ç”¨æˆ·**: `admin`
   - **é»˜è®¤å¯†ç **: `admin`

### 2.2 webç«¯é…ç½®æ ¸å¿ƒ

è®©æ ‘è“æ´¾æœ¬èº«å¯ä»¥é€šè¿‡ä»£ç†è¿›è¡Œæ™ºèƒ½åˆ†æµï¼Œç”¨äº `apt`ã€`curl` ç­‰å‘½ä»¤è¡Œå·¥å…·ã€‚

1. **ç¼–è¾‘é…ç½®æ–‡ä»¶**:

   webç«¯ç‚¹å‡»è®¾ç½®----xrayè®¾ç½®----å³è¾¹ç²˜è´´jsoné…ç½®----é‡å¯é¢æ¿**å†™å…¥æœ€ç»ˆç‰ˆ JSON é…ç½®**: (æ­¤é…ç½®å·²åŒ…å«æ™ºèƒ½åˆ†æµè§„åˆ™å’Œæ‚¨æä¾›çš„æœºåœºèŠ‚ç‚¹ä¿¡æ¯)

   ```JSON
   {
     "log": {
       "access": "",
       "error": "",
       "loglevel": "warning"
     },
     "dns": {
       "servers": [
         "1.1.1.1",
         "8.8.8.8"
       ]
     },
     "stats": {},
     "policy": {
       "system": {
         "statsOutboundUplink": true,
         "statsOutboundDownlink": true
       }
     },
     "inbounds": [
       {
         "tag": "socks-in",
         "port": 10808,
         "listen": "127.0.0.1",
         "protocol": "socks",
         "sniffing": {
           "enabled": true,
           "destOverride": ["http", "tls"]
         },
         "settings": {
           "auth": "noauth",
           "udp": true
         }
       },
       {
         "tag": "http-in",
         "port": 10809,
         "listen": "127.0.0.1",
         "protocol": "http",
         "sniffing": {
           "enabled": true,
           "destOverride": ["http", "tls"]
         },
         "settings": {}
       }
     ],
     "outbounds": [
       {
         "tag": "proxy",
         "protocol": "shadowsocks",
         "settings": {
           "servers": [
             {
               "address": "gheianygh.yangliq.com",
               "method": "aes-128-gcm",
               "ota": false,
               "password": "319600b1-309f-4275-be70-56c9e4f62358",
               "port": 31002,
               "level": 1
             }
           ]
         },
         "streamSettings": {
           "network": "tcp"
         },
         "mux": {
           "enabled": false
         }
       },
       {
         "tag": "direct",
         "protocol": "freedom",
         "settings": {}
       },
       {
         "tag": "block",
         "protocol": "blackhole",
         "settings": {
           "response": {
             "type": "http"
           }
         }
       }
     ],
     "routing": {
       "domainStrategy": "AsIs",
       "rules": [
         {
           "type": "field",
           "ip": [
             "geoip:private",
             "geoip:cn"
           ],
           "outboundTag": "direct"
         },
         {
           "type": "field",
           "domain": [
             "geosite:cn"
           ],
           "outboundTag": "direct"
         },
         {
           "type": "field",
           "domain": [
             "geosite:category-ads-all"
           ],
           "outboundTag": "block"
         },
         {
           "type": "field",
           "network": "tcp,udp",
           "outboundTag": "proxy"
         }
       ]
     }
   }
   ```

**å¦‚ä¿®æ”¹èŠ‚ç‚¹,v2rayå¯¼å‡ºåï¼Œå¯¹åº”ä¿®æ”¹outboundsï¼Œå‡ºç«™è§„åˆ™å³å¯**

#### 2.3 é…ç½®ç³»ç»Ÿå…¨å±€ä»£ç†

1. **ç¼–è¾‘ç¯å¢ƒå˜é‡æ–‡ä»¶**:

   ```
   sudo nano /etc/environment
   ```

2. **åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹**ï¼Œå°†ç³»ç»Ÿä»£ç†æŒ‡å‘ V2Ray æä¾›çš„ HTTP ç«¯å£ï¼š

   ```bash
   http_proxy="http://127.0.0.1:10809"
   https_proxy="http://127.0.0.1:10809"
   no_proxy="localhost,127.0.0.1,::1,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,.local"
   ```

3. **æ›´æ”¹dockerä»£ç†ä¸º127.0.0.1:10809**

4. **é‡å¯æ ‘è“æ´¾ä½¿é…ç½®ç”Ÿæ•ˆ**:

   ```bash
   sudo reboot
   ```

   é‡å¯åï¼Œæ ‘è“æ´¾çš„å‘½ä»¤è¡Œç¯å¢ƒå³å¯è‡ªåŠ¨ä½¿ç”¨ V2Ray è¿›è¡Œæ™ºèƒ½åˆ†æµä»£ç†ã€‚

### **Shell é…ç½®æ–‡ä»¶é…ç½®å…¨å±€å±€åŸŸç½‘ä»£ç†**

ä»£ç†é€šå¸¸è®¾ç½®åœ¨ç”¨æˆ·çš„ Shell åˆå§‹åŒ–æ–‡ä»¶ä¸­ã€‚æ ¹æ®ä½ çš„ Shellï¼ˆ`bash`ï¼‰ï¼Œæ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶ï¼š

```bash
# æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ç¯å¢ƒé…ç½®æ–‡ä»¶
cat ~/.bashrc | grep -i proxy
cat ~/.bash_profile | grep -i proxy
cat ~/.profile | grep -i proxy

# å¦‚æœä½¿ç”¨ zshï¼ˆé»˜è®¤ä¸æ˜¯ï¼Œä½†å¯æ£€æŸ¥ï¼‰
cat ~/.zshrc | grep -i proxy
```

#### ç”¨ `nano` ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ï¼š

```bash
nano ~/.bashrc
```

#### æ‰¾åˆ°è¿™ä¸¤è¡Œï¼ˆä½ åˆšæ‰ç”¨ `grep` å·²ç»çœ‹åˆ°äº†å®ƒä»¬ï¼‰ï¼š

```bash
export http_proxy="http://192.168.124.20:10811"
export https_proxy="http://192.168.124.20:10811"
```

#### åˆ é™¤æˆ–æ³¨é‡Šæ‰å®ƒä»¬ï¼š

- â€¢**åˆ é™¤**ï¼šç›´æ¥åˆ é™¤è¿™ä¸¤è¡Œã€‚

- **æ³¨é‡Š**ï¼ˆæ¨èï¼Œå¯ä¿ç•™è®°å½•ï¼‰ï¼šåœ¨è¡Œé¦–åŠ  `#`ï¼Œå˜æˆï¼š

  ```bash
  #export http_proxy="http://192.168.124.20:10811"
  #export https_proxy="http://192.168.124.20:10811"
  ```

#### ä¿å­˜å¹¶é€€å‡ºï¼š

- â€¢æŒ‰ `Ctrl + O` ä¿å­˜ â†’ å›è½¦ç¡®è®¤ â†’ `Ctrl + X` é€€å‡ºã€‚

#### ç«‹å³ç”Ÿæ•ˆï¼š

```bash
source ~/.bashrc  # é‡æ–°åŠ è½½é…ç½®
env | grep -i proxy  # éªŒè¯ä»£ç†å˜é‡æ˜¯å¦å·²æ¶ˆå¤±
```

## ä¸‰ã€æœåŠ¡åŠè½¯ä»¶å®‰è£…

### 1.dockerå®‰è£…

```bash
# å®‰è£…Docker (å¦‚æœå°šæœªå®‰è£…)
# sudo apt update && sudo apt install docker.io -y
# sudo systemctl enable --now docker
# sudo usermod -aG docker pi # å°†piç”¨æˆ·æ·»åŠ åˆ°dockerç»„ï¼Œæ³¨æ„ï¼šæ³¨é”€åé‡æ–°ç™»å½•ç”Ÿæ•ˆ
```

#### **1.1å®‰è£…ç‹¬ç«‹çš„ Docker Compose**

```bash
# ä¸‹è½½ Docker Compose çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ° /usr/local/bin ç›®å½•
sudo curl -L "https://github.com/docker/compose/releases/download/v2.27.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# ç»™äºˆä¸‹è½½çš„æ–‡ä»¶å¯æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ
docker-compose --version
```

å¦‚æœæœ€åä¸€æ¡å‘½ä»¤è¾“å‡ºäº†ç‰ˆæœ¬å·ï¼ˆå¦‚ `Docker Compose version v2.27.1`ï¼‰ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚

>
>
>#æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æœ€è¿‘æ—¥å¿—
>
>docker logs <å®¹å™¨åæˆ–ID>
>
>#æŸ¥çœ‹ x-ui å®¹å™¨çš„æ—¥å¿—ï¼ˆå‡è®¾å®¹å™¨åä¸º x-uiï¼‰
>
>docker logs x-ui
>
>#å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆç±»ä¼¼ tail -fï¼‰
>
>docker logs -f x-ui
>
>#æŸ¥çœ‹æœ€å N è¡Œæ—¥å¿—
>
>docker logs --tail 100 x-ui
>
>#æŸ¥çœ‹ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—
>
>docker logs --since 2024-01-01 --until 2024-01-02 x-ui

### **2.ä¸º Docker æœåŠ¡æœ¬èº«é…ç½®ä»£ç†**

**ä¸º Docker æœåŠ¡åˆ›å»ºä¸€ä¸ªé…ç½®ç›®å½•**

```bash
sudo mkdir -p /etc/systemd/system/docker.service.d
```

**åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶æ¥è®¾ç½®ä»£ç†**

```bash
sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf
```

**å°†ä»¥ä¸‹å†…å®¹å®Œæ•´åœ°ç²˜è´´åˆ°æ–‡ä»¶ä¸­**

```bash
[Service]
Environment="HTTP_PROXY=http://192.168.31.109:10811/"
Environment="HTTPS_PROXY=http://192.168.31.109:10811/"
Environment="NO_PROXY=localhost,127.0.0.1,*.lan"
```

**ä¿å­˜å¹¶é€€å‡º** æŒ‰ `Ctrl + X`ï¼Œç„¶åæŒ‰ `Y`ï¼Œå†æŒ‰ `Enter`ã€‚

**é‡æ–°åŠ è½½é…ç½®å¹¶é‡å¯ Docker æœåŠ¡ï¼Œè®©é…ç½®ç”Ÿæ•ˆ**

```bash
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 3.Netdataç›‘æ§è½¯ä»¶å®‰è£…

Netdata æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ã€åˆ†å¸ƒå¼çš„ã€å®æ—¶çš„æ€§èƒ½å’Œå¥åº·ç›‘æ§ç³»ç»Ÿã€‚å®ƒä¸ºæœåŠ¡å™¨ã€å®¹å™¨ã€åº”ç”¨ç¨‹åºç­‰æä¾›æ— ä¸ä¼¦æ¯”çš„å®æ—¶æ´å¯Ÿã€‚å®ƒçš„Webç•Œé¢éå¸¸ç›´è§‚ï¼Œå¯ä»¥å¼€ç®±å³ç”¨åœ°æ”¶é›†æ•°åƒä¸ªæŒ‡æ ‡ã€‚

#### 3.1. åˆ›å»ºé¡¹ç›®ç›®å½•

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºå­˜æ”¾ Netdata é…ç½®çš„ç›®å½•ï¼Œå¹¶è¿›å…¥è¯¥ç›®å½•ã€‚

```bash
mkdir docker/netdata-docker
cd docker/netdata-docker
```

#### 3.2. åˆ›å»º `docker-compose.yml` æ–‡ä»¶

åœ¨ `netdata-docker` ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `docker-compose.yml` çš„æ–‡ä»¶ã€‚

```bash
touch docker-compose.yml
```

ç„¶åï¼Œä½¿ç”¨ä½ å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ `vim` æˆ– `nano`ï¼‰æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹å†…å®¹å¤åˆ¶è¿›å»ã€‚

```bash
version: '3'
services:
  netdata:
    image: netdata/netdata
    container_name: netdata
    hostname: ${HOSTNAME} # å°†å®¹å™¨çš„ä¸»æœºåè®¾ç½®ä¸ºå®¿ä¸»æœºçš„ï¼Œæ–¹ä¾¿åœ¨Netdataä¸­è¯†åˆ«
    ports:
      - "19999:19999"
    restart: unless-stopped
    cap_add:
      - SYS_PTRACE # éœ€è¦æ­¤æƒé™ä»¥è¿›è¡Œå®Œæ•´çš„è¿›ç¨‹ç›‘æ§
    security_opt:
      - apparmor:unconfined
    volumes:
      - netdataconfig:/etc/netdata   # æŒä¹…åŒ–Netdataçš„é…ç½®
      - netdatalib:/var/lib/netdata    # æŒä¹…åŒ–Netdataçš„æ•°æ®å’ŒæŒ‡æ ‡
      - netdatacache:/var/cache/netdata  # æŒä¹…åŒ–Netdataçš„ç¼“å­˜
      - /etc/passwd:/host/etc/passwd:ro  # åªè¯»æŒ‚è½½ï¼Œç”¨äºç”¨æˆ·/ç»„åè§£æ
      - /etc/group:/host/etc/group:ro    # åªè¯»æŒ‚è½½ï¼Œç”¨äºç”¨æˆ·/ç»„åè§£æ
      - /proc:/host/proc:ro              # åªè¯»æŒ‚è½½ï¼Œè®¿é—®å®¿ä¸»æœºçš„è¿›ç¨‹ä¿¡æ¯
      - /sys:/host/sys:ro                # åªè¯»æŒ‚è½½ï¼Œè®¿é—®å®¿ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯
      - /etc/os-release:/host/etc/os-release:ro # åªè¯»æŒ‚è½½ï¼Œè·å–å®¿ä¸»æœºæ“ä½œç³»ç»Ÿä¿¡æ¯
    environment:
      - NETDATA_CLAIM_TOKEN= # å¦‚æœä½ æƒ³è¿æ¥åˆ°Netdata Cloudï¼Œè¯·åœ¨è¿™é‡Œå¡«å…¥ä½ çš„Token
      - NETDATA_CLAIM_URL=https://app.netdata.cloud
      - NETDATA_CLAIM_ROOMS= # å¯é€‰ï¼Œå¡«å…¥ä½ æƒ³è¦åŠ å…¥çš„Room

# å®šä¹‰å‘½åçš„å·ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨
volumes:
  netdataconfig:
  netdatalib:
  netdatacache:
```

**é…ç½®è¯´æ˜:**

- **`image: netdata/netdata`**: ä½¿ç”¨å®˜æ–¹çš„ Netdata Docker é•œåƒã€‚
- **`container_name: netdata`**: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªå›ºå®šçš„åç§°ã€‚
- **`hostname: ${HOSTNAME}`**: è¿™ä¸€è¡Œä¼šè‡ªåŠ¨è·å–ä½ å®¿ä¸»æœºçš„ä¸»æœºåå¹¶èµ‹ç»™å®¹å™¨ï¼Œè¿™æ ·åœ¨ Netdata çš„ä»ªè¡¨ç›˜ä¸­å°±èƒ½æ¸…æ™°åœ°çœ‹åˆ°æ˜¯å“ªå°æœåŠ¡å™¨ã€‚
- **`ports: - "19999:19999"`**: å°†å®¹å™¨çš„ `19999` ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ `19999` ç«¯å£ã€‚è¿™æ˜¯ Netdata Web ç•Œé¢çš„é»˜è®¤ç«¯å£ã€‚
- **`restart: unless-stopped`**: é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™å®¹å™¨ä¼šåœ¨é€€å‡ºåè‡ªåŠ¨é‡å¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨å®¿ä¸»æœºé‡å¯åï¼‰ã€‚
- **`cap_add` å’Œ `security_opt`**: è¿™äº›é€‰é¡¹ç»™äºˆ Netdata å®¹å™¨å¿…è¦çš„æƒé™ï¼Œä»¥ä¾¿å®ƒå¯ä»¥ç›‘æ§å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰è¿›ç¨‹å’ŒæœåŠ¡ã€‚
- **`volumes`**:
  - `netdataconfig`, `netdatalib`, `netdatacache`: è¿™ä¸‰ä¸ªæ˜¯ Docker çš„å‘½åå·ï¼ˆnamed volumesï¼‰ï¼Œç”¨äºæŒä¹…åŒ–å­˜å‚¨ Netdata çš„é…ç½®ã€å†å²æŒ‡æ ‡æ•°æ®å’Œç¼“å­˜ã€‚å³ä½¿ä½ åˆ é™¤å¹¶é‡å»ºå®¹å™¨ï¼Œè¿™äº›æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚
  - ä»¥ `/host/` å¼€å¤´çš„æŒ‚è½½ï¼šè¿™äº›æ˜¯å°†å®¿ä¸»æœºçš„å…³é”®ç³»ç»Ÿç›®å½•ä»¥**åªè¯»ï¼ˆ`:ro`ï¼‰**æ¨¡å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚è¿™ä½¿å¾— Netdata å®¹å™¨èƒ½å¤Ÿâ€œçœ‹åˆ°â€å¹¶ç›‘æ§å®¿ä¸»æœºçš„å®Œæ•´çŠ¶æ€ï¼Œè€Œä¸ä¼šæœ‰ä¿®æ”¹å®¿ä¸»æœºç³»ç»Ÿçš„é£é™©ã€‚è¿™æ˜¯å®˜æ–¹æ¨èçš„æœ€ä½³å®è·µã€‚
- **`environment`**: å¦‚æœä½ æƒ³å°†è¿™ä¸ª Netdata ä»£ç†è¿æ¥åˆ°å…è´¹çš„ [Netdata Cloud](https://app.netdata.cloud/) ä»¥è¿›è¡Œé›†ä¸­ç®¡ç†å’ŒæŸ¥çœ‹ï¼Œä½ éœ€è¦åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ `CLAIM_TOKEN`ã€‚ä½ å¯ä»¥åœ¨ Netdata Cloud ä¸Šæ³¨å†Œå¹¶åˆ›å»ºä¸€ä¸ª "Space" æ¥è·å–å®ƒã€‚å¦‚æœæš‚æ—¶ä¸éœ€è¦ï¼Œå¯ä»¥ç•™ç©ºã€‚

#### 3.3. å¯åŠ¨ Netdata å®¹å™¨

åœ¨åŒ…å« `docker-compose.yml` æ–‡ä»¶çš„ç›®å½•ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ Netdata æœåŠ¡ï¼š

```
docker-compose up -d
```

- `up`: åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ã€‚
- `-d`: è¡¨ç¤ºâ€œdetachedâ€æ¨¡å¼ï¼Œå³åœ¨åå°è¿è¡Œå®¹å™¨ã€‚

Docker Compose ä¼šè‡ªåŠ¨ä¸‹è½½æœ€æ–°çš„ `netdata/netdata` é•œåƒå¹¶æ ¹æ®ä½ çš„é…ç½®æ–‡ä»¶åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨ã€‚

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š

```
docker-compose ps
```

```
docker ps
```

ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªåä¸º `netdata` çš„å®¹å™¨æ­£åœ¨è¿è¡Œã€‚

#### 3.4è®¿é—® Netdata ä»ªè¡¨ç›˜

ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„ç½‘ç»œæµè§ˆå™¨ï¼Œè®¿é—®ï¼š

```
http://<ä½ çš„æœåŠ¡å™¨IPåœ°å€>:19999
```

#### 3.5 ç®¡ç† Netdata æœåŠ¡

ä½¿ç”¨ `docker-compose` å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç®¡ç† Netdata æœåŠ¡ï¼š

- **åœæ­¢æœåŠ¡**:

  ```
  docker-compose stop
  ```

- **å†æ¬¡å¯åŠ¨æœåŠ¡**:

  ```
  docker-compose start
  ```

- **æŸ¥çœ‹æ—¥å¿—**:

  ```
  docker-compose logs -f
  ```

- **æ›´æ–° Netdata é•œåƒ**:

  ```
  # 1. æ‹‰å–æœ€æ–°çš„é•œåƒ
  docker-compose pull
  
  # 2. åœæ­¢å¹¶é‡æ–°åˆ›å»ºå®¹å™¨ä»¥åº”ç”¨æ–°é•œåƒ
  docker-compose up -d --force-recreate
  ```

- **åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œå’Œå·**:

  > **è­¦å‘Š**: è¿™ä¸ªå‘½ä»¤ä¼šåˆ é™¤æ‰€æœ‰ä¸œè¥¿ï¼ŒåŒ…æ‹¬ä½ åœ¨ `docker-compose.yml` ä¸­å®šä¹‰çš„å‘½åå·ï¼ˆé™¤éå®ƒä»¬è¢«æ ‡è®°ä¸º `external`ï¼‰ã€‚è¿™æ„å‘³ç€ä½ ä¼šä¸¢å¤±æ‰€æœ‰å†å²ç›‘æ§æ•°æ®ã€‚

  ```
  docker-compose down
  ```

  > å¦‚æœä½ æƒ³ä¿ç•™æ•°æ®å·ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

  ```
  docker-compose down --volumes
  ```

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å°±æˆåŠŸåœ°ä½¿ç”¨ Docker Compose å®‰è£…å¹¶è¿è¡Œäº† Netdataï¼Œå¹¶ä¸”é…ç½®äº†æ•°æ®æŒä¹…åŒ–ï¼Œç¡®ä¿äº†å¯¹å®¿ä¸»æœºçš„å…¨é¢ç›‘æ§ã€‚

### 4.immichç›¸å†ŒæœåŠ¡å®‰è£…

æœ¬æ–‡æ¡£ä¸ºåœ¨ **Raspberry Pi 4B (64ä½ç³»ç»Ÿ)** ä¸Šï¼Œé€šè¿‡ Docker Compose æˆåŠŸéƒ¨ç½² Immich ç§æœ‰äº‘ç›¸å†Œçš„æœ€ç»ˆå®‰è£…æŒ‡å—ã€‚

> **æ ¸å¿ƒç­–ç•¥**ï¼šç”±äºæ ‡å‡†é•œåƒæ ‡ç­¾ï¼ˆTagï¼‰åœ¨ç‰¹å®šä»£ç†ç½‘ç»œç¯å¢ƒä¸‹å¯èƒ½æ— æ³•è¢«æ­£ç¡®æ‹‰å–ï¼Œæœ¬æŒ‡å—é‡‡ç”¨**æŒ‡å®šç²¾ç¡®å“ˆå¸Œå€¼ï¼ˆDigest/SHA256ï¼‰**çš„â€œç»ˆææ–¹æ¡ˆâ€ï¼Œä»¥ä¿è¯100%ç»•è¿‡ç½‘ç»œç¼“å­˜å’Œåè®®é—®é¢˜ï¼Œç¡®ä¿å®‰è£…æˆåŠŸã€‚

#### 4.1. å‡†å¤‡å·¥ä½œ

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®Œæˆä»¥ä¸‹åŸºç¡€å‡†å¤‡ã€‚

##### 4.1.1. (å‰ç½®è¦æ±‚) ç¡®è®¤64ä½æ“ä½œç³»ç»Ÿ

è¿™æ˜¯å®‰è£…æˆåŠŸçš„**ç»å¯¹å‰æ**ã€‚è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ç¡®è®¤æ‚¨çš„æ“ä½œç³»ç»Ÿç”¨æˆ·ç©ºé—´æ˜¯64ä½çš„ã€‚

```bash
dpkg --print-architecture
```

**é¢„æœŸè¾“å‡ºå¿…é¡»æ˜¯ `arm64`**ã€‚å¦‚æœè¾“å‡ºæ˜¯ `armhf`ï¼Œåˆ™æ‚¨éœ€è¦åœæ­¢å®‰è£…ï¼Œå¹¶ä¸ºæ ‘è“æ´¾é‡è£…ä¸€ä¸ª64ä½çš„æ“ä½œç³»ç»Ÿã€‚

##### 4.1.2. ç³»ç»Ÿä¸å·¥å…·æ›´æ–°

ç¡®ä¿ç³»ç»ŸåŠè½¯ä»¶åŒ…ä¸ºæœ€æ–°çŠ¶æ€ï¼Œå¹¶å®‰è£… `git` å·¥å…·ç”¨äºä¸‹è½½é…ç½®ã€‚

```bash
sudo apt update && sudo apt full-upgrade -y
sudo apt install git -y
```

##### 4.1.3. å‡†å¤‡å¤–éƒ¨å­˜å‚¨

ç…§ç‰‡å’Œæ•°æ®åº“**å¿…é¡»**å­˜æ”¾åœ¨å¤–ç½®ç¡¬ç›˜ï¼ˆæ¨èSSDï¼‰ä¸Šï¼Œè€Œä¸æ˜¯SDå¡ã€‚

1. **è¿æ¥ç¡¬ç›˜**ï¼šå°†æ‚¨çš„å¤–ç½®ç¡¬ç›˜è¿æ¥åˆ°æ ‘è“æ´¾çš„ USB 3.0 ç«¯å£ã€‚

2. **ç¡®è®¤æŒ‚è½½è·¯å¾„**ï¼šä½¿ç”¨ `lsblk` å‘½ä»¤æ‰¾åˆ°æ‚¨çš„ç¡¬ç›˜æŒ‚è½½ç‚¹ã€‚æœ¬æ–‡æ¡£å°†ä»¥ `/media/pi/SNF` ä¸ºä¾‹ï¼Œ**è¯·åœ¨åç»­æ­¥éª¤ä¸­æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„çœŸå®è·¯å¾„**ã€‚

3. **åˆ›å»ºæ•°æ®ç›®å½•**ï¼š

   ```bash
   # è¯·å°† /media/pi/SNF æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®è·¯å¾„
   sudo mkdir -p /media/pi/SNF/immich/photos
   sudo mkdir -p /media/pi/SNF/immich/database
   
   # æˆäºˆå½“å‰piç”¨æˆ·è¯»å†™æƒé™
   sudo chown -R pi:pi /media/pi/SNF/immich/
   ```

#### 4.2. è·å–å¹¶é…ç½® Immich

##### 4.2.1. ä¸‹è½½å®˜æ–¹é…ç½®æ–‡ä»¶

```bash
# åˆ›å»ºdocker/immichç›®å½•
mkdir docker/immich
cd docker/immich
# ä¸‹è½½ docker-compose.yml å’Œ .env æ¨¡æ¿
wget -O docker-compose.yml https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml
wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env
```

##### 4.2.2. é…ç½® `.env` æ–‡ä»¶

è¿›å…¥é…ç½®ç›®å½•ï¼Œå¹¶æ ¹æ®æ¨¡æ¿åˆ›å»ºæ‚¨çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ã€‚

```bash
nano .env
```

åœ¨æ‰“å¼€çš„ç¼–è¾‘å™¨ä¸­ï¼Œä¿®æ”¹ä»¥ä¸‹å…³é”®å†…å®¹ï¼š

ä»£ç æ®µ

```
# 1. ä¿®æ”¹ç…§ç‰‡ä¸Šä¼ è·¯å¾„
UPLOAD_LOCATION=/media/pi/SNF/immich/photos

# 2. ä¿®æ”¹æ•°æ®åº“å­˜å‚¨è·¯å¾„
DB_DATA_LOCATION=/media/pi/SNF/immich/database/

# 3. (å¼ºçƒˆå»ºè®®) ä¿®æ”¹æ•°æ®åº“å¯†ç ä¸ºä¸€ä¸ªéšæœºå¼ºå¯†ç 
DB_PASSWORD=YourOwnStrongPasswordHere

# 4. (é‡è¦) ç¡®ä¿ IMMICH_VERSION è¿™ä¸€è¡Œè¢«æ³¨é‡Šæ‰æˆ–ä¸å­˜åœ¨ï¼Œå› ä¸ºå®ƒå°†è¢«ymlæ–‡ä»¶ä¸­çš„å“ˆå¸Œå€¼è¦†ç›–
# IMMICH_VERSION=release

# 5. (å¯é€‰) è®¾ç½®æ—¶åŒº
TZ=Asia/Shanghai
```

ä¿®æ”¹å®Œæˆåï¼ŒæŒ‰ `Ctrl+X` -> `Y` -> `Enter` ä¿å­˜å¹¶é€€å‡ºã€‚

#### 4.3. æœ€ç»ˆçš„ `docker-compose.yml` æ–‡ä»¶

è¿™æ˜¯è§£å†³æ‚¨ç½‘ç»œé—®é¢˜çš„æ ¸å¿ƒã€‚è¯¥æ–‡ä»¶å·²ä¸ºæ‚¨é…ç½®ä¸ºä½¿ç”¨ç²¾ç¡®çš„å“ˆå¸Œå€¼æ¥æ‹‰å–æ‰€æœ‰é•œåƒã€‚

1. **æ‰“å¼€ `docker-compose.yml` æ–‡ä»¶**ï¼š

   ```bash
   nano docker-compose.yml
   ```

2. **å®Œæ•´æ›¿æ¢æ–‡ä»¶å†…å®¹**ï¼š è¯·åˆ é™¤æ–‡ä»¶å†…çš„æ‰€æœ‰å†…å®¹ï¼Œç„¶åå°†ä¸‹é¢å·²ç»ä¸ºæ‚¨å‡†å¤‡å¥½çš„ã€åŒ…å«äº†æ­£ç¡®å“ˆå¸Œå€¼çš„å®Œæ•´é…ç½®**å…¨éƒ¨å¤åˆ¶**å¹¶ç²˜è´´è¿›å»ã€‚

   YAML

   ```bash
   #
   # WARNING: To install Immich, follow our guide: [https://immich.app/docs/install/docker-compose](https://immich.app/docs/install/docker-compose)
   #
   # Make sure to use the docker-compose.yml of the current release:
   #
   # [https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml](https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml)
   #
   # The compose file on main may not be compatible with the latest release.
   
   name: immich
   
   services:
     immich-server:
       container_name: immich_server
       image: ghcr.io/immich-app/immich-server@sha256:d763855c74ff5e3b4590969e54e183271da69b8008c0e3fe596666ed6d801010
       # extends:
       #   file: hwaccel.transcoding.yml
       #   service: cpu # set to one of [nvenc, quicksync, rkmpp, vaapi, vaapi-wsl] for accelerated transcoding
       volumes:
         # Do not edit the next line. If you want to change the media storage location on your system, edit the value of UPLOAD_LOCATION in the .env file
         - ${UPLOAD_LOCATION}:/data
         - /etc/localtime:/etc/localtime:ro
       env_file:
         - .env
       ports:
         - '2283:2283'
       depends_on:
         - redis
         - database
       restart: always
       healthcheck:
         disable: false
   
     immich-machine-learning:
       container_name: immich_machine_learning
       # For hardware acceleration, add one of -[armnn, cuda, rocm, openvino, rknn] to the image tag.
       # Example tag: ${IMMICH_VERSION:-release}-cuda
       image: ghcr.io/immich-app/immich-machine-learning@sha256:b7e615dfd780999e9faea032da4a87b89edea16450fbdfa33b3abd66435cec48
       # extends: # uncomment this section for hardware acceleration - see [https://immich.app/docs/features/ml-hardware-acceleration](https://immich.app/docs/features/ml-hardware-acceleration)
       #   file: hwaccel.ml.yml
       #   service: cpu # set to one of [armnn, cuda, rocm, openvino, openvino-wsl, rknn] for accelerated inference - use the `-wsl` version for WSL2 where applicable
       volumes:
         - model-cache:/cache
       env_file:
         - .env
       restart: always
       healthcheck:
         disable: false
   
     redis:
       container_name: immich_redis
       image: docker.io/valkey/valkey:8-bookworm@sha256:a137a2b60aca1a75130022d6bb96af423fefae4eb55faf395732db3544803280
       healthcheck:
         test: redis-cli ping || exit 1
       restart: always
   
     database:
       container_name: immich_postgres
       image: ghcr.io/immich-app/postgres:16-vectorchord0.4.3-pgvectors0.3.0@sha256:1c94b619829fda273d9b8fe78ad800b1be311bfd40053e1be4508a2b0ac67b7e
       environment:
         POSTGRES_PASSWORD: ${DB_PASSWORD}
         POSTGRES_USER: ${DB_USERNAME}
         POSTGRES_DB: ${DB_DATABASE_NAME}
         POSTGRES_INITDB_ARGS: '--data-checksums'
         # Uncomment the DB_STORAGE_TYPE: 'HDD' var if your database isn't stored on SSDs
         # DB_STORAGE_TYPE: 'HDD'
       volumes:
         # Do not edit the next line. If you want to change the database storage location on your system, edit the value of DB_DATA_LOCATION in the .env file
         - ${DB_DATA_LOCATION}:/var/lib/postgresql/data
       shm_size: 128mb
       restart: always
   
   volumes:
     model-cache:
   ```

3. æŒ‰ `Ctrl+X` -> `Y` -> `Enter` ä¿å­˜å¹¶é€€å‡ºã€‚

#### 4.4. å¯åŠ¨ä¸éªŒè¯

##### 4.4.1. å¯åŠ¨æœåŠ¡

åœ¨ `immich/docker` ç›®å½•ä¸‹ï¼Œè¿è¡Œå¯åŠ¨å‘½ä»¤ã€‚

```bash
docker-compose up -d
```

Dockerä¼šä½¿ç”¨ç²¾ç¡®çš„å“ˆå¸Œå€¼å»æ‹‰å–é•œåƒã€‚å¦‚æœæ‚¨ä¹‹å‰å·²ç»æ‰‹åŠ¨æ‹‰å–è¿‡ï¼Œå®ƒä¼šç›´æ¥è·³è¿‡ä¸‹è½½å¹¶ç«‹å³å¯åŠ¨ã€‚

##### 4.4.2. æ£€æŸ¥çŠ¶æ€

ç­‰å¾…å‡ åˆ†é’Ÿï¼Œè®©æ‰€æœ‰æœåŠ¡å®Œæˆåˆå§‹åŒ–ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹çŠ¶æ€ï¼š

```bash
docker-compose ps
```

æ‚¨åº”è¯¥èƒ½çœ‹åˆ°æ‰€æœ‰æœåŠ¡éƒ½å¤„äº `Up` æˆ– `running` çŠ¶æ€ã€‚

##### 4.4.3. åˆæ¬¡è®¿é—®

åœ¨æ‚¨çš„ç”µè„‘æµè§ˆå™¨ä¸­ï¼Œè®¿é—® `http://<ä½ çš„æ ‘è“æ´¾IPåœ°å€>:2283`ã€‚æ‚¨ä¼šçœ‹åˆ° Immich çš„æ¬¢è¿é¡µé¢ï¼Œè¯·æ ¹æ®æŒ‡å¼•æ³¨å†Œæ‚¨çš„ç¬¬ä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·ã€‚

#### 4.5. åç»­ç»´æŠ¤

##### 4.5.1. å¦‚ä½•æ›´æ–° Immich

å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†å†™æ­»çš„å“ˆå¸Œå€¼ï¼Œæ›´æ–° Immich éœ€è¦æ‰‹åŠ¨æ“ä½œï¼š

1. **è®¿é—®é•œåƒæ›´æ–°åœ°å€**ï¼š

   - `immich-server`: https://github.com/immich-app/immich/pkgs/container/immich-server
   - `immich-machine-learning`: https://github.com/immich-app/immich/pkgs/container/immich-machine-learning
   - `database` (postgres): [https://github.com/orgs/immich-app/packages/container/package/postgres](https://www.google.com/search?q=https://github.com/orgs/immich-app/packages/container/package/postgres)
   - `redis` (valkey): [https://hub.docker.com/_/valkey/tags](https://www.google.com/search?q=https://hub.docker.com/_/valkey/tags)

2. **æŸ¥æ‰¾æ–°å“ˆå¸Œå€¼**ï¼š æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰å®è·µè¿‡çš„æ–¹æ³•ï¼Œè¿›å…¥ç›¸åº”é¡µé¢ï¼Œæ‰¾åˆ°æ–°ç‰ˆæœ¬å¯¹åº”çš„ `linux/arm64` çš„æ–°å“ˆå¸Œå€¼ã€‚

3. **æ›´æ–° `.yml` æ–‡ä»¶**ï¼š æ‰‹åŠ¨ç¼–è¾‘ `docker-compose.yml` æ–‡ä»¶ï¼Œå°†æ—§çš„å“ˆå¸Œå€¼æ›¿æ¢ä¸ºæ–°æ‰¾åˆ°çš„å“ˆå¸Œå€¼ã€‚

4. **æ‹‰å–å¹¶é‡å¯æœåŠ¡**ï¼š åœ¨ `immich/docker` ç›®å½•ä¸‹è¿è¡Œï¼š

   ```bash
   docker-compose pull
   docker-compose up -d
   ```

##### 4.5.2. å¦‚ä½•å¤‡ä»½

æ‚¨çš„æ‰€æœ‰æ ¸å¿ƒæ•°æ®éƒ½åœ¨å¤–ç½®ç¡¬ç›˜ä¸Šã€‚è¯·åŠ¡å¿…å®šæœŸå¤‡ä»½ä»¥ä¸‹ä¸¤ä¸ªç›®å½•ï¼š

- `/media/pi/SNF/immich/photos` (æ‚¨çš„æ‰€æœ‰ç…§ç‰‡å’Œè§†é¢‘)
- `/media/pi/SNF/immich/database` (æ‚¨çš„æ‰€æœ‰ç›¸å†Œä¿¡æ¯ã€ç”¨æˆ·æ•°æ®ç­‰)

### 5.çšæœˆè¿ä¸‹è½½å®‰è£…

ä½¿ç”¨ Docker Compose åœ¨æ‚¨çš„ Raspberry Pi ä¸Šéƒ¨ç½² `xiyu505/natpierce` æœåŠ¡ï¼Œä»¥ä¾¿äºè¿›è¡Œå†…ç½‘ç©¿é€ã€è™šæ‹Ÿç»„ç½‘ç­‰æ“ä½œã€‚ä½¿ç”¨ `docker-compose` å¯ä»¥è®©é…ç½®æ›´æ¸…æ™°ï¼Œç®¡ç†æ›´æ–¹ä¾¿ã€‚

> **æ ¸å¿ƒé…ç½®**ï¼šæ­¤æœåŠ¡çš„å…³é”®é…ç½®åœ¨äºä½¿ç”¨äº† `--net=host` å’Œ `--privileged` æ¨¡å¼ï¼Œæ„å‘³ç€å®ƒå°†ç›´æ¥ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œï¼Œå¹¶æ‹¥æœ‰è¾ƒé«˜çš„ç³»ç»Ÿæƒé™ï¼Œè¿™æ˜¯å®ç°å…¶ç½‘ç»œåŠŸèƒ½çš„å¿…è¦æ¡ä»¶ã€‚

#### 5.1. å‡†å¤‡å·¥ä½œ

ä¸ºæœåŠ¡åˆ›å»ºä¸€ä¸ªä¸“å±çš„ç›®å½•ï¼Œä»¥å­˜æ”¾å…¶é…ç½®æ–‡ä»¶ã€‚

```bash
# åœ¨æ‚¨å–œæ¬¢çš„ä½ç½®åˆ›å»ºç›®å½•ï¼Œä¾‹å¦‚åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹
cd ~
mkdir jiaoyuelian
cd jiaoyuelian
```

#### 5.2. åˆ›å»º `docker-compose.yml` æ–‡ä»¶

1. **åˆ›å»ºæ–‡ä»¶**ï¼š åœ¨ `jiaoyuelian` ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ `docker-compose.yml` æ–‡ä»¶ã€‚

   ```bash
   nano docker-compose.yml
   ```

2. **ç²˜è´´å†…å®¹**ï¼š å°†ä»¥ä¸‹å†…å®¹å®Œæ•´å¤åˆ¶å¹¶ç²˜è´´åˆ°æ–‡ä»¶ä¸­ã€‚

   ```yaml
   # docker-compose.yml for natpierce (çšæœˆé“¾)
   # Version of the Docker Compose file format
   version: '3.8'
   
   # Define the services (containers)
   services:
     # The name of our service
     natpierce:
       # The Docker image to use
       image: xiyu505/natpierce:latest
       # Set the container name to 'natpierce'
       container_name: natpierce
       # Always restart the container if it stops
       restart: always
       # Use the host's network stack directly. Required for NAT traversal.
       network_mode: host
       # Run the container in privileged mode. Required for network manipulations.
       privileged: true
       # Mount a named volume to persist data
       volumes:
         - natpierce_data:/natpierce
   
   # Declare the named volume used by the service
   volumes:
     natpierce_data: {}
   ```

3. æŒ‰ `Ctrl+X` -> `Y` -> `Enter` ä¿å­˜å¹¶é€€å‡ºã€‚

#### 5.3. å¯åŠ¨ä¸éªŒè¯

1. **å¯åŠ¨æœåŠ¡**ï¼š åœ¨ `jiaoyuelian` ç›®å½•ä¸‹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ã€‚

   ```bash
   docker-compose up -d
   ```

2. **æ£€æŸ¥çŠ¶æ€**ï¼š è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚

   ```bash
   docker ps
   ```

æ‘„åƒå¤´é‡‡é›†
cd mjpg-streamer/mjpg-streamer-experimental

./mjpg_streamer -i "input_uvc.so -d /dev/video0 -r 640x480 -f 30 -yuv" -o "output_http.so -p 8080 -w /usr/local/share/mjpg-streamer/www"