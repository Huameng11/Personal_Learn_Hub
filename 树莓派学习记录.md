# 树莓派4B学习记录

## 一、基础配置

> 王村路由器下IP地址：192.168.124.41
>
> 楼上路由器下IP：192.168.31.203
>
> 用户名：pi
> 密码：raspberry
> 新密码：hua.

- **硬件配置**

  >  pi@raspberrypi 
  > OS: Raspbian GNU/Linux 12 (bookworm) aarch64 
  > Host: Raspberry Pi 4 Model B Rev 1.5 
  > Kernel: 6.1.0-rpi7-rpi-v8 
  > Uptime: 36 mins 
  > Packages: 1558 (dpkg) 
  > Shell: bash 5.2.15 
  > Terminal: /dev/pts/0 
  > CPU: (4) @ 1.800GHz 
  > Memory: 216MiB / 7811MiB 

### 装系统

- 下方地址，下载官方工具**Raspberry Pi Imager**
- https://www.raspberrypi.com/software/

- 安装带桌面64位镜像
- 手动下载镜像地址
- https://www.raspberrypi.com/software/operating-systems/

## 二、基础命令

### 1.改密码

```bash
passwd
```

### 🖥️ 系统信息与状态管理

| 命令                    | 说明                           | 示例/备注                                             |
| :---------------------- | :----------------------------- | :---------------------------------------------------- |
| `hostname -I`           | **查看树莓派的IP地址**         | 这是通过SSH连接的关键信息                             |
| `uname -a`              | 显示系统详细内核信息           |                                                       |
| `cat /etc/os-release`   | **查看操作系统版本**           | 确认你运行的Raspberry Pi OS版本                       |
| `vcgencmd measure_temp` | **查看树莓派SoC（CPU）温度**   | 非常实用的硬件监控命令                                |
| `uptime`                | 查看系统运行了多久             |                                                       |
| `top` 或 `htop`         | **动态实时查看进程和资源占用** | `htop` 更直观，可能需要安装 (`sudo apt install htop`) |
| `df -h`                 | **查看磁盘空间使用情况**       | `-h` 选项表示以人类易读（GB, MB）格式显示             |
| `free -h`               | **查看内存（RAM）使用情况**    |                                                       |
| `exit` 或 `logout`      | **退出当前终端或SSH会话**      |                                                       |

### 📁 文件与目录操作（最常用！）

| 命令                               | 说明                                 | 示例/备注                                                    |
| :--------------------------------- | :----------------------------------- | :----------------------------------------------------------- |
| `pwd`                              | **显示当前所在的目录路径**           |                                                              |
| `ls`                               | **列出当前目录下的文件和文件夹**     | `ls -l` 显示详细信息， `ls -a` 显示隐藏文件                  |
| `cd <目录名>`                      | **切换目录**                         | `cd ~` 回家目录， `cd ..` 返回上级目录                       |
| `mkdir <目录名>`                   | **创建新目录**                       | `mkdir my_project`                                           |
| df-h                               | **查看挂载硬盘**                     |                                                              |
| `rmdir <目录名>`                   | 删除**空**目录                       |                                                              |
| `rm <文件名>`                      | **删除文件**                         | `rm -r <目录名>` **递归删除目录及其内容（慎用！）**          |
| `cp <源文件> <目标位置>`           | **复制文件或目录**                   | `cp file.txt ~/backups/` `cp -r dir1/ dir2/` (复制目录)      |
| `mv <源> <目标>`                   | **移动文件或目录（重命名）**         | `mv old.txt new.txt` (重命名) `mv file.txt ~/documents/` (移动) |
| `cat <文件名>`                     | **在终端中显示文件全部内容**         | 适合查看短文件                                               |
| `more <文件名>` 或 `less <文件名>` | **分页显示文件内容**                 | 适合查看长文件，按空格翻页，按 `q` 退出                      |
| `nano <文件名>`                    | **使用nano文本编辑器修改或创建文件** | **树莓派自带，对新手最友好**，Ctrl+X退出，按Y保存            |
| `sudo reboot`                      | **立即重启树莓派**                   |                                                              |
| `sudo shutdown now`                | **立即关机**                         | `sudo shutdown -h now` 效果相同                              |

### 📦 软件包管理 (使用 `apt`)

| 命令                          | 说明                                             | 示例/备注                                |
| :---------------------------- | :----------------------------------------------- | :--------------------------------------- |
| `sudo apt update`             | **更新软件包列表**（获取可用软件的最新版本信息） | **在安装任何新软件前，最好先运行此命令** |
| `sudo apt upgrade`            | **升级所有已安装的软件包**                       | 根据网络速度，可能需要较长时间           |
| `sudo apt install <软件包名>` | **安装一个软件**                                 | `sudo apt install htop`                  |
| `sudo apt remove <软件包名>`  | **卸载一个软件**                                 |                                          |
| `sudo apt autoremove`         | **自动删除不再需要的依赖包**                     | 清理空间                                 |

### 👤 用户与权限管理 (理解 `sudo`)

| 命令                | 说明                               | 示例/备注                                              |
| :------------------ | :--------------------------------- | :----------------------------------------------------- |
| `passwd`            | **修改当前用户的密码**             | 就是你刚才问的第一个问题                               |
| `sudo <命令>`       | **以超级管理员(root)权限执行命令** | 安装软件、修改系统配置等操作都需要加 `sudo`            |
| `sudo raspi-config` | **启动树莓派官方配置工具**         | 在这里可以扩展文件系统、更改密码、启用摄像头/SSH等接口 |
| `chmod +x <文件名>` | **给文件添加“可执行”权限**         | 当你下载了一个脚本后，需要用它来使脚本可以运行         |

### 🌐 网络相关命令

| 命令          | 说明                             | 示例/备注                                           |
| :------------ | :------------------------------- | :-------------------------------------------------- |
| `ping <地址>` | **测试网络连接**                 | `ping google.com` 或 `ping 8.8.8.8`，按 Ctrl+C 停止 |
| `ifconfig`    | 查看网络接口配置信息（如IP地址） | 旧命令，可用 `ip addr` 替代                         |
| `iwconfig`    | 查看无线网络信息                 |                                                     |

### 🔧 进程管理

| 命令             | 说明                       | 示例/备注                                |
| :--------------- | :------------------------- | :--------------------------------------- |
| `ps aux`         | **查看当前运行的所有进程** |                                          |
| `kill <PID>`     | **结束一个进程**           | `<PID>` 是进程号，可以用 `ps aux` 查看到 |
| `pkill <进程名>` | 根据进程名结束进程         | `pkill chromium`                         |

## 2.网络代理设置相关

### **检查 Shell 配置文件**

代理通常设置在用户的 Shell 初始化文件中。根据你的 Shell（`bash`），检查以下文件：

```
# 查看当前用户的环境配置文件
cat ~/.bashrc | grep -i proxy
cat ~/.bash_profile | grep -i proxy
cat ~/.profile | grep -i proxy

# 如果使用 zsh（默认不是，但可检查）
cat ~/.zshrc | grep -i proxy
```

#### 用 `nano` 编辑器打开文件：

```
nano ~/.bashrc
```

#### 找到这两行（你刚才用 `grep` 已经看到了它们）：

```
export http_proxy="http://192.168.124.20:10811"
export https_proxy="http://192.168.124.20:10811"
```

#### 删除或注释掉它们：

- •**删除**：直接删除这两行。

- **注释**（推荐，可保留记录）：在行首加 `#`，变成：

  ```
  #export http_proxy="http://192.168.124.20:10811"
  #export https_proxy="http://192.168.124.20:10811"
  ```

#### 保存并退出：

- •按 `Ctrl + O` 保存 → 回车确认 → `Ctrl + X` 退出。

#### 立即生效：

```
source ~/.bashrc  # 重新加载配置
env | grep -i proxy  # 验证代理变量是否已消失
```

## 三、服务及软件安装

### 1.docker安装

```
# 安装Docker (如果尚未安装)
# sudo apt update && sudo apt install docker.io -y
# sudo systemctl enable --now docker
# sudo usermod -aG docker pi # 将pi用户添加到docker组，注销后重新登录生效
```

#### **1.1安装独立的 Docker Compose**

```
# 下载 Docker Compose 的二进制文件到 /usr/local/bin 目录
sudo curl -L "https://github.com/docker/compose/releases/download/v2.27.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# 给予下载的文件可执行权限
sudo chmod +x /usr/local/bin/docker-compose

# 验证安装是否成功
docker-compose --version
```

如果最后一条命令输出了版本号（如 `Docker Compose version v2.27.1`），说明安装成功。

### **2.为 Docker 服务本身配置代理**

**为 Docker 服务创建一个配置目录**

```
sudo mkdir -p /etc/systemd/system/docker.service.d
```

**创建一个新的配置文件来设置代理**

```
sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf
```

**将以下内容完整地粘贴到文件中**

```
[Service]
Environment="HTTP_PROXY=http://192.168.31.109:10811/"
Environment="HTTPS_PROXY=http://192.168.31.109:10811/"
Environment="NO_PROXY=localhost,127.0.0.1,*.lan"
```

**保存并退出** 按 `Ctrl + X`，然后按 `Y`，再按 `Enter`。

**重新加载配置并重启 Docker 服务，让配置生效**

```
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 3.Netdata监控软件安装

Netdata 是一个功能强大的、分布式的、实时的性能和健康监控系统。它为服务器、容器、应用程序等提供无与伦比的实时洞察。它的Web界面非常直观，可以开箱即用地收集数千个指标。

#### 3.1. 创建项目目录

首先，创建一个专门用于存放 Netdata 配置的目录，并进入该目录。

```
mkdir docker/netdata-docker
cd docker/netdata-docker
```

#### 3.2. 创建 `docker-compose.yml` 文件

在 `netdata-docker` 目录中，创建一个名为 `docker-compose.yml` 的文件。

```
touch docker-compose.yml
```

然后，使用你喜欢的文本编辑器（如 `vim` 或 `nano`）打开这个文件，并将以下内容复制进去。

```bash
version: '3'
services:
  netdata:
    image: netdata/netdata
    container_name: netdata
    hostname: ${HOSTNAME} # 将容器的主机名设置为宿主机的，方便在Netdata中识别
    ports:
      - "19999:19999"
    restart: unless-stopped
    cap_add:
      - SYS_PTRACE # 需要此权限以进行完整的进程监控
    security_opt:
      - apparmor:unconfined
    volumes:
      - netdataconfig:/etc/netdata   # 持久化Netdata的配置
      - netdatalib:/var/lib/netdata    # 持久化Netdata的数据和指标
      - netdatacache:/var/cache/netdata  # 持久化Netdata的缓存
      - /etc/passwd:/host/etc/passwd:ro  # 只读挂载，用于用户/组名解析
      - /etc/group:/host/etc/group:ro    # 只读挂载，用于用户/组名解析
      - /proc:/host/proc:ro              # 只读挂载，访问宿主机的进程信息
      - /sys:/host/sys:ro                # 只读挂载，访问宿主机的系统信息
      - /etc/os-release:/host/etc/os-release:ro # 只读挂载，获取宿主机操作系统信息
    environment:
      - NETDATA_CLAIM_TOKEN= # 如果你想连接到Netdata Cloud，请在这里填入你的Token
      - NETDATA_CLAIM_URL=https://app.netdata.cloud
      - NETDATA_CLAIM_ROOMS= # 可选，填入你想要加入的Room

# 定义命名的卷，用于持久化存储
volumes:
  netdataconfig:
  netdatalib:
  netdatacache:
```

**配置说明:**

- **`image: netdata/netdata`**: 使用官方的 Netdata Docker 镜像。
- **`container_name: netdata`**: 为容器指定一个固定的名称。
- **`hostname: ${HOSTNAME}`**: 这一行会自动获取你宿主机的主机名并赋给容器，这样在 Netdata 的仪表盘中就能清晰地看到是哪台服务器。
- **`ports: - "19999:19999"`**: 将容器的 `19999` 端口映射到宿主机的 `19999` 端口。这是 Netdata Web 界面的默认端口。
- **`restart: unless-stopped`**: 除非手动停止，否则容器会在退出后自动重启（例如，在宿主机重启后）。
- **`cap_add` 和 `security_opt`**: 这些选项给予 Netdata 容器必要的权限，以便它可以监控宿主机上的所有进程和服务。
- **`volumes`**:
  - `netdataconfig`, `netdatalib`, `netdatacache`: 这三个是 Docker 的命名卷（named volumes），用于持久化存储 Netdata 的配置、历史指标数据和缓存。即使你删除并重建容器，这些数据也不会丢失。
  - 以 `/host/` 开头的挂载：这些是将宿主机的关键系统目录以**只读（`:ro`）**模式挂载到容器中。这使得 Netdata 容器能够“看到”并监控宿主机的完整状态，而不会有修改宿主机系统的风险。这是官方推荐的最佳实践。
- **`environment`**: 如果你想将这个 Netdata 代理连接到免费的 [Netdata Cloud](https://app.netdata.cloud/) 以进行集中管理和查看，你需要在这里填入你的 `CLAIM_TOKEN`。你可以在 Netdata Cloud 上注册并创建一个 "Space" 来获取它。如果暂时不需要，可以留空。

#### 3.3. 启动 Netdata 容器

在包含 `docker-compose.yml` 文件的目录中，运行以下命令来启动 Netdata 服务：

```
docker-compose up -d
```

- `up`: 创建并启动容器。
- `-d`: 表示“detached”模式，即在后台运行容器。

Docker Compose 会自动下载最新的 `netdata/netdata` 镜像并根据你的配置文件创建和启动容器。

你可以使用以下命令查看容器是否正在运行：

```
docker-compose ps
```

```
docker ps
```

你应该能看到一个名为 `netdata` 的容器正在运行。

#### 3.4访问 Netdata 仪表盘

现在，打开你的网络浏览器，访问：

```
http://<你的服务器IP地址>:19999
```

#### 3.5 管理 Netdata 服务

使用 `docker-compose` 可以很方便地管理 Netdata 服务：

- **停止服务**:

  ```
  docker-compose stop
  ```

- **再次启动服务**:

  ```
  docker-compose start
  ```

- **查看日志**:

  ```
  docker-compose logs -f
  ```

- **更新 Netdata 镜像**:

  ```
  # 1. 拉取最新的镜像
  docker-compose pull
  
  # 2. 停止并重新创建容器以应用新镜像
  docker-compose up -d --force-recreate
  ```

- **停止并删除容器、网络和卷**:

  > **警告**: 这个命令会删除所有东西，包括你在 `docker-compose.yml` 中定义的命名卷（除非它们被标记为 `external`）。这意味着你会丢失所有历史监控数据。

  ```
  docker-compose down
  ```

  > 如果你想保留数据卷，可以使用：

  ```
  docker-compose down --volumes
  ```

通过以上步骤，你就成功地使用 Docker Compose 安装并运行了 Netdata，并且配置了数据持久化，确保了对宿主机的全面监控。

### 4.immich相册服务安装

本文档为在 **Raspberry Pi 4B (64位系统)** 上，通过 Docker Compose 成功部署 Immich 私有云相册的最终安装指南。

> **核心策略**：由于标准镜像标签（Tag）在特定代理网络环境下可能无法被正确拉取，本指南采用**指定精确哈希值（Digest/SHA256）**的“终极方案”，以保证100%绕过网络缓存和协议问题，确保安装成功。

#### 4.1. 准备工作

在开始之前，请确保完成以下基础准备。

##### 4.1.1. (前置要求) 确认64位操作系统

这是安装成功的**绝对前提**。请运行以下命令确认您的操作系统用户空间是64位的。

```bash
dpkg --print-architecture
```

**预期输出必须是 `arm64`**。如果输出是 `armhf`，则您需要停止安装，并为树莓派重装一个64位的操作系统。

##### 4.1.2. 系统与工具更新

确保系统及软件包为最新状态，并安装 `git` 工具用于下载配置。

```bash
sudo apt update && sudo apt full-upgrade -y
sudo apt install git -y
```

##### 4.1.3. 准备外部存储

照片和数据库**必须**存放在外置硬盘（推荐SSD）上，而不是SD卡。

1. **连接硬盘**：将您的外置硬盘连接到树莓派的 USB 3.0 端口。

2. **确认挂载路径**：使用 `lsblk` 命令找到您的硬盘挂载点。本文档将以 `/media/pi/SNF` 为例，**请在后续步骤中替换为您自己的真实路径**。

3. **创建数据目录**：

   ```bash
   # 请将 /media/pi/SNF 替换为您的真实路径
   sudo mkdir -p /media/pi/SNF/immich/photos
   sudo mkdir -p /media/pi/SNF/immich/database
   
   # 授予当前pi用户读写权限
   sudo chown -R pi:pi /media/pi/SNF/immich/
   ```

#### 4.2. 获取并配置 Immich

##### 4.2.1. 下载官方配置文件

```bash
# 创建docker/immich目录
mkdir docker/immich
cd docker/immich
# 下载 docker-compose.yml 和 .env 模板
wget -O docker-compose.yml https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml
wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env
```

##### 4.2.2. 配置 `.env` 文件

进入配置目录，并根据模板创建您的环境配置文件。

```bash
nano .env
```

在打开的编辑器中，修改以下关键内容：

代码段

```
# 1. 修改照片上传路径
UPLOAD_LOCATION=/media/pi/SNF/immich/photos

# 2. 修改数据库存储路径
DB_DATA_LOCATION=/media/pi/SNF/immich/database/

# 3. (强烈建议) 修改数据库密码为一个随机强密码
DB_PASSWORD=YourOwnStrongPasswordHere

# 4. (重要) 确保 IMMICH_VERSION 这一行被注释掉或不存在，因为它将被yml文件中的哈希值覆盖
# IMMICH_VERSION=release

# 5. (可选) 设置时区
TZ=Asia/Shanghai
```

修改完成后，按 `Ctrl+X` -> `Y` -> `Enter` 保存并退出。

#### 4.3. 最终的 `docker-compose.yml` 文件

这是解决您网络问题的核心。该文件已为您配置为使用精确的哈希值来拉取所有镜像。

1. **打开 `docker-compose.yml` 文件**：

   ```bash
   nano docker-compose.yml
   ```

2. **完整替换文件内容**： 请删除文件内的所有内容，然后将下面已经为您准备好的、包含了正确哈希值的完整配置**全部复制**并粘贴进去。

   YAML

   ```bash
   #
   # WARNING: To install Immich, follow our guide: [https://immich.app/docs/install/docker-compose](https://immich.app/docs/install/docker-compose)
   #
   # Make sure to use the docker-compose.yml of the current release:
   #
   # [https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml](https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml)
   #
   # The compose file on main may not be compatible with the latest release.
   
   name: immich
   
   services:
     immich-server:
       container_name: immich_server
       image: ghcr.io/immich-app/immich-server@sha256:d763855c74ff5e3b4590969e54e183271da69b8008c0e3fe596666ed6d801010
       # extends:
       #   file: hwaccel.transcoding.yml
       #   service: cpu # set to one of [nvenc, quicksync, rkmpp, vaapi, vaapi-wsl] for accelerated transcoding
       volumes:
         # Do not edit the next line. If you want to change the media storage location on your system, edit the value of UPLOAD_LOCATION in the .env file
         - ${UPLOAD_LOCATION}:/data
         - /etc/localtime:/etc/localtime:ro
       env_file:
         - .env
       ports:
         - '2283:2283'
       depends_on:
         - redis
         - database
       restart: always
       healthcheck:
         disable: false
   
     immich-machine-learning:
       container_name: immich_machine_learning
       # For hardware acceleration, add one of -[armnn, cuda, rocm, openvino, rknn] to the image tag.
       # Example tag: ${IMMICH_VERSION:-release}-cuda
       image: ghcr.io/immich-app/immich-machine-learning@sha256:b7e615dfd780999e9faea032da4a87b89edea16450fbdfa33b3abd66435cec48
       # extends: # uncomment this section for hardware acceleration - see [https://immich.app/docs/features/ml-hardware-acceleration](https://immich.app/docs/features/ml-hardware-acceleration)
       #   file: hwaccel.ml.yml
       #   service: cpu # set to one of [armnn, cuda, rocm, openvino, openvino-wsl, rknn] for accelerated inference - use the `-wsl` version for WSL2 where applicable
       volumes:
         - model-cache:/cache
       env_file:
         - .env
       restart: always
       healthcheck:
         disable: false
   
     redis:
       container_name: immich_redis
       image: docker.io/valkey/valkey:8-bookworm@sha256:a137a2b60aca1a75130022d6bb96af423fefae4eb55faf395732db3544803280
       healthcheck:
         test: redis-cli ping || exit 1
       restart: always
   
     database:
       container_name: immich_postgres
       image: ghcr.io/immich-app/postgres:16-vectorchord0.4.3-pgvectors0.3.0@sha256:1c94b619829fda273d9b8fe78ad800b1be311bfd40053e1be4508a2b0ac67b7e
       environment:
         POSTGRES_PASSWORD: ${DB_PASSWORD}
         POSTGRES_USER: ${DB_USERNAME}
         POSTGRES_DB: ${DB_DATABASE_NAME}
         POSTGRES_INITDB_ARGS: '--data-checksums'
         # Uncomment the DB_STORAGE_TYPE: 'HDD' var if your database isn't stored on SSDs
         # DB_STORAGE_TYPE: 'HDD'
       volumes:
         # Do not edit the next line. If you want to change the database storage location on your system, edit the value of DB_DATA_LOCATION in the .env file
         - ${DB_DATA_LOCATION}:/var/lib/postgresql/data
       shm_size: 128mb
       restart: always
   
   volumes:
     model-cache:
   ```

3. 按 `Ctrl+X` -> `Y` -> `Enter` 保存并退出。

#### 4.4. 启动与验证

##### 4.4.1. 启动服务

在 `immich/docker` 目录下，运行启动命令。

```bash
docker-compose up -d
```

Docker会使用精确的哈希值去拉取镜像。如果您之前已经手动拉取过，它会直接跳过下载并立即启动。

##### 4.4.2. 检查状态

等待几分钟，让所有服务完成初始化，然后运行以下命令查看状态：

```bash
docker-compose ps
```

您应该能看到所有服务都处于 `Up` 或 `running` 状态。

##### 4.4.3. 初次访问

在您的电脑浏览器中，访问 `http://<你的树莓派IP地址>:2283`。您会看到 Immich 的欢迎页面，请根据指引注册您的第一个管理员账户。

#### 4.5. 后续维护

##### 4.5.1. 如何更新 Immich

因为我们使用了写死的哈希值，更新 Immich 需要手动操作：

1. **访问镜像更新地址**：

   - `immich-server`: https://github.com/immich-app/immich/pkgs/container/immich-server
   - `immich-machine-learning`: https://github.com/immich-app/immich/pkgs/container/immich-machine-learning
   - `database` (postgres): [https://github.com/orgs/immich-app/packages/container/package/postgres](https://www.google.com/search?q=https://github.com/orgs/immich-app/packages/container/package/postgres)
   - `redis` (valkey): [https://hub.docker.com/_/valkey/tags](https://www.google.com/search?q=https://hub.docker.com/_/valkey/tags)

2. **查找新哈希值**： 按照我们之前实践过的方法，进入相应页面，找到新版本对应的 `linux/arm64` 的新哈希值。

3. **更新 `.yml` 文件**： 手动编辑 `docker-compose.yml` 文件，将旧的哈希值替换为新找到的哈希值。

4. **拉取并重启服务**： 在 `immich/docker` 目录下运行：

   ```bash
   docker-compose pull
   docker-compose up -d
   ```

##### 4.5.2. 如何备份

您的所有核心数据都在外置硬盘上。请务必定期备份以下两个目录：

- `/media/pi/SNF/immich/photos` (您的所有照片和视频)
- `/media/pi/SNF/immich/database` (您的所有相册信息、用户数据等)

### 5.皎月连下载安装

使用 Docker Compose 在您的 Raspberry Pi 上部署 `xiyu505/natpierce` 服务，以便于进行内网穿透、虚拟组网等操作。使用 `docker-compose` 可以让配置更清晰，管理更方便。

> **核心配置**：此服务的关键配置在于使用了 `--net=host` 和 `--privileged` 模式，意味着它将直接使用主机的网络，并拥有较高的系统权限，这是实现其网络功能的必要条件。

#### 5.1. 准备工作

为服务创建一个专属的目录，以存放其配置文件。

```bash
# 在您喜欢的位置创建目录，例如在用户主目录下
cd ~
mkdir jiaoyuelian
cd jiaoyuelian
```

#### 5.2. 创建 `docker-compose.yml` 文件

1. **创建文件**： 在 `jiaoyuelian` 目录下，创建一个新的 `docker-compose.yml` 文件。

   ```bash
   nano docker-compose.yml
   ```

2. **粘贴内容**： 将以下内容完整复制并粘贴到文件中。

   ```yaml
   # docker-compose.yml for natpierce (皎月链)
   # Version of the Docker Compose file format
   version: '3.8'
   
   # Define the services (containers)
   services:
     # The name of our service
     natpierce:
       # The Docker image to use
       image: xiyu505/natpierce:latest
       # Set the container name to 'natpierce'
       container_name: natpierce
       # Always restart the container if it stops
       restart: always
       # Use the host's network stack directly. Required for NAT traversal.
       network_mode: host
       # Run the container in privileged mode. Required for network manipulations.
       privileged: true
       # Mount a named volume to persist data
       volumes:
         - natpierce_data:/natpierce
   
   # Declare the named volume used by the service
   volumes:
     natpierce_data: {}
   ```

3. 按 `Ctrl+X` -> `Y` -> `Enter` 保存并退出。

#### 5.3. 启动与验证

1. **启动服务**： 在 `jiaoyuelian` 目录下，运行以下命令启动服务。

   ```bash
   docker-compose up -d
   ```

2. **检查状态**： 运行以下命令查看容器是否正在运行。

   ```bash
   docker ps
   ```

摄像头采集
cd mjpg-streamer/mjpg-streamer-experimental

./mjpg_streamer -i "input_uvc.so -d /dev/video0 -r 640x480 -f 30 -yuv" -o "output_http.so -p 8080 -w /usr/local/share/mjpg-streamer/www"